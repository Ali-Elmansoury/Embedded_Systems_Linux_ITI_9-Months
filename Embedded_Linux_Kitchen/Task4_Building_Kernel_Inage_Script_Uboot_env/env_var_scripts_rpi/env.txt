arch=arm
baudrate=115200
board=rpi
board_name=3 Model B+
board_rev=0xD
board_rev_scheme=1
board_revision=0xA020D4
boot_targets=mmc usb pxe dhcp
bootdelay=5
cpu=armv8
dhcpuboot=usb start; dhcp u-boot.uimg; bootm
ethaddr=b8:27:eb:fb:19:b6
fdt_addr=2effa500
fdt_addr_r=0x02600000
fdt_high=ffffffffffffffff
fdtcontroladdr=3af45370
fdtfile=bcm2837-rpi-3-b-plus.dtb
initrd_high=ffffffffffffffff
kernel_addr_r=0x00080000
loadaddr=0x1000000
preboot=usb start
pxefile_addr_r=0x02500000
ramdisk_addr_r=0x02700000
scriptaddr=0x02400000
serial#=0000000041fb19b6
soc=bcm283x
stderr=serial,vidconsole
stdin=serial,usbkbd
stdout=serial,vidconsole
usb_ignorelist=0x1050:*,
usbethaddr=b8:27:eb:fb:19:b6
vendor=raspberrypi
ipaddr=192.168.1.5
serverip=192.168.1.19
bootcmd=run loadFromFat

load_dtb_mmc=fatload mmc 0:1 ${fdt_addr_r} ${fdtfile}

load_dtb_tftp=tftp ${fdt_addr_r} ${fdtfile}

checkFileFromMmc=if fatload mmc 0:1 ${kernel_addr_r} Image; then \
    echo "Image loaded from MMC"; \
    if run load_dtb_mmc; then \
        echo "DTB loaded from MMC"; \
        setenv bootargs console=ttyUSB0,115200 root=/dev/mmcblk0p2 rootwait earlyprintk; \
        booti ${kernel_addr_r} - ${fdt_addr_r}; \
    else \
        echo "Failed to load DTB from MMC"; \
    fi; \
else \
    echo "Failed to load Image from MMC, trying TFTP..."; \
    run loadFromTftp; \
fi

loadFromFat=if mmc dev; then \
    echo "MMC device found, checking for Image..."; \
    run checkFileFromMmc; \
else \
    echo "MMC device not found, trying TFTP..."; \
    run loadFromTftp; \
fi

loadFromTftp=if tftp ${kernel_addr_r} Image; then \
    echo "Image loaded from TFTP"; \
    if run load_dtb_tftp; then \
        echo "DTB loaded from TFTP"; \
        setenv bootargs console=ttyUSB0,115200 root=/dev/mmcblk0p2 rootwait earlyprintk; \
        booti ${kernel_addr_r} - ${fdt_addr_r}; \
    else \
        echo "Failed to load DTB from TFTP"; \
    fi; \
else \
    echo "Failed to load Image from TFTP, loading GPIO..."; \
    run gpio; \
fi

gpio=fatload mmc 0:1 ${kernel_addr_r} gpio.img; \
    echo "GPIO loaded from MMC"; \
    go ${kernel_addr_r}
